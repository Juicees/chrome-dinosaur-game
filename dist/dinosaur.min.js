function getTimeNow(){return+new Date}function polygonCollidesWithPolygon(t,i,e){var n=t.minimumTranslationVector(t.getAxes(),i,e),s=t.minimumTranslationVector(i.getAxes(),i,e);return 0===n.overlap||0===s.overlap?{axis:void 0,overlap:0}:n.overlap<s.overlap?n:s}function circleCollidesWithCircle(t,i){var e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n=Math.abs(t.radius+i.radius)-e;return n<0?new MinimumTranslationVector((void 0),0):new MinimumTranslationVector((void 0),n)}function getPolygonPointClosestToCircle(t,i){for(var e,n,s,r=BIG_NUMBER,a=0;a<t.points.length;++a)n=t.points[a],e=Math.sqrt(Math.pow(n.x-i.x,2),Math.pow(n.y-i.y,2)),e<r&&(r=e,s=n);return s}function getCircleAxis(t,i,e){var n=new Vector(new Point(t.x,t.y)),s=new Vector(new Point(e.x,e.y)),r=n.subtract(s);return r.normalize()}function polygonCollidesWithCircle(t,i,e){var n=t.getAxes(),s=getPolygonPointClosestToCircle(t,i);return n.push(getCircleAxis(i,t,s)),t.minimumTranslationVector(n,i,e)}function getMTV(t,i,e,n){for(var s,r,a,o=BIG_NUMBER,h=0;h<n.length;++h){if(axis=n[h],projection1=t.project(axis),projection2=i.project(axis),s=projection1.getOverlap(projection2),0===s)return new MinimumTranslationVector((void 0),0);s<o&&(o=s,r=axis)}return a=new MinimumTranslationVector(r,o)}var Background=function(){function t(t,i,e){s.offset=s.offset<s.coordinate.width?s.offset+s.velocity/e:0,n.offset=n.offset<s.coordinate.width?n.offset+n.velocity/e:0,t.save(),t.translate(-s.offset,0),t.drawImage(i,s.coordinate.x,s.coordinate.y,2400,s.coordinate.height,0,canvas.height-s.coordinate.height,2400,s.coordinate.height),t.drawImage(i,s.coordinate.x,s.coordinate.y,2400,s.coordinate.height,2388,canvas.height-s.coordinate.height,2400,s.coordinate.height),t.restore(),t.save(),t.translate(-n.offset,0),t.drawImage(i,n.coordinate.x,n.coordinate.y,n.coordinate.width,n.coordinate.height,100,30,n.coordinate.width,n.coordinate.height),t.drawImage(i,n.coordinate.x,n.coordinate.y,n.coordinate.width,n.coordinate.height,800,30,n.coordinate.width,n.coordinate.height),t.drawImage(i,n.coordinate.x,n.coordinate.y,n.coordinate.width,n.coordinate.height,1100,30,n.coordinate.width,n.coordinate.height),t.drawImage(i,n.coordinate.x,n.coordinate.y,n.coordinate.width,n.coordinate.height,1800,30,n.coordinate.width,n.coordinate.height),t.restore()}function i(){n.offset=0,s.offset=0,n.velocity=20,s.velocity=300}function e(t){n.velocity=20*t,s.velocity=300*t}var n={offset:0,velocity:20,coordinate:{x:163,y:0,width:100,height:32}},s={offset:0,velocity:300,coordinate:{x:12,y:100,width:2400,height:24}};return{drawBackground:t,setVelocity:e,reset:i}}(),Cacti={sprite:null,imagePainter:null,coordinate:[{left:654,top:0,width:46,height:95,drawWidth:46*.6,drawHeight:57},{left:754,top:0,width:46,height:95,drawWidth:46*.6,drawHeight:57},{left:754,top:0,width:94,height:95,drawWidth:56.4,drawHeight:57},{left:654,top:0,width:93,height:95,drawWidth:55.8,drawHeight:57},{left:851,top:0,width:98,height:95,drawWidth:58.8,drawHeight:57}],init:function(t,i,e){this.sprite=Object.create(Sprite),this.imagePainter=Object.create(ImagePainter),this.sprite.name="cacti",this.sprite.painter=this.imagePainter,this.imagePainter.cell=this.coordinate[e],this.imagePainter.image=i,this.sprite.behaviors=[this.move],this.sprite.top=t.height-this.coordinate[e].drawHeight-5,this.sprite.left=t.width,this.sprite.initShape(this.sprite.left,this.sprite.top+10,this.coordinate[e].drawWidth-10,this.coordinate[e].drawHeight)},setVelocity:function(t){this.move.velocityX=300*t},reset:function(){this.move.velocityX=300},move:{velocityX:300,execute:function(t,i,e,n){var s=this.velocityX*n;t.shape.move(-s,0),t.left-=s}}},Dinosaur={sprite:null,spriteSheetPainter:null,runCoordinate:[{left:1858,top:0,width:80,height:96,drawWidth:48,drawHeight:96*.6},{left:1945,top:0,width:80,height:96,drawWidth:48,drawHeight:96*.6}],deadCoordinate:[{left:2033,top:0,width:80,height:96,drawWidth:48,drawHeight:96*.6}],gbCoordinate:[{left:2206,top:38,width:110,height:54,drawWidth:66,drawHeight:32.4},{left:2325,top:38,width:110,height:54,drawWidth:66,drawHeight:32.4}],RISE_DURATION:350,FALL_DURATION:250,HEIGHT:100,riseTimer:null,fallTimer:null,height:1,init:function(t,i){this.sprite=Object.create(Sprite),this.spriteSheetPainter=Object.create(SpriteSheetPainter),this.spriteSheetPainter.init(i,this.runCoordinate),this.sprite.name="dinosaur",this.sprite.top=t.height-this.runCoordinate[0].drawHeight-8,this.sprite.left=20,this.sprite.painter=this.spriteSheetPainter,this.sprite.behaviors=[this.runInplace,this.jump],this.sprite.initShape(this.sprite.left+6,this.sprite.top+8,this.runCoordinate[0].drawWidth-15,this.runCoordinate[0].drawHeight-8),this.initTimeWarp(),this.jump.self=this,this.runInplace.self=this,this.jump.orignTop=this.sprite.top},initTimeWarp:function(){this.riseTimer=Object.create(TimeWarper),this.fallTimer=Object.create(TimeWarper),this.riseTimer.init(this.RISE_DURATION,TimeWarper.makeEaseOut(.9)),this.fallTimer.init(this.FALL_DURATION,TimeWarper.makeEaseIn(.9))},updateDinosaur:function(){this.riseTimer.isRunning()?this.riseTimer.isOver()?(this.riseTimer.stop(),this.height=this.HEIGHT,this.fallTimer.start()):this.height=this.HEIGHT-this.HEIGHT/this.RISE_DURATION*this.riseTimer.getElapsedTime()+1:this.fallTimer.isRunning()&&(this.fallTimer.isOver()?(this.fallTimer.stop(),this.height=0):this.height=this.HEIGHT-this.HEIGHT/this.FALL_DURATION*this.fallTimer.getElapsedTime())},dead:function(){this.sprite.top=canvas.height-this.runCoordinate[0].drawHeight-8,this.jump.orignTop=this.sprite.top,this.spriteSheetPainter.cells=this.deadCoordinate,this.spriteSheetPainter.cellIndex=0},goBallistic:function(t){this.spriteSheetPainter.cells=this.gbCoordinate,this.sprite.top=t.height-this.runCoordinate[0].drawHeight+15,this.jump.orignTop=this.sprite.top},reset:function(t){this.height=1,this.riseTimer.stop(),this.fallTimer.stop(),this.runInplace.lastAdvance=0,this.jump.status=!1,this.dead.status=!1,this.spriteSheetPainter.cells=this.runCoordinate,this.sprite.top=t.height-this.runCoordinate[0].drawHeight-8,this.jump.orignTop=this.sprite.top},runInplace:{self:null,lastAdvance:0,PAGE_FLIP_INTERVAL:100,execute:function(t,i,e,n){this.self.jump.status||e-this.lastAdvance>this.PAGE_FLIP_INTERVAL&&(t.painter.advance(),this.lastAdvance=e)}},jump:{self:null,status:!1,orignTop:0,execute:function(t,i,e,n){if(this.status){this.self.height<=0&&(this.status=!1);var s=0,r=t.top;t.top=this.orignTop-this.self.height,s=t.top-r,t.shape.move(0,s)}}}},Game={gameName:"",canvasId:"",canvas:null,context:null,sprites:[],shapes:[],startTime:0,lastTime:0,gameTime:0,frameTime:0,fps:0,START_FPS:60,startedPauseAt:0,PAUSE_TIMEOUT:100,paused:!1,loading:!0,gameOver:!1,passGame:!1,init:function(t,i){this.gameName=t,this.canvasId=i,this.canvas=document.getElementById(i),this.context=this.canvas.getContext("2d"),this.soundInit(),this.keyEventInit()},start:function(){var t=this;this.startTime=getTimeNow(),requestAnimationFrame(function(i){t.animate(i)})},tick:function(t){this.updateFrameRate(t),this.lastTime=t},updateFrameRate:function(t){if(0===this.lastTime)this.fps=this.START_FPS;else{var i=(t-this.lastTime)/1e3;this.frameTime=i>0&&i<.5?i:0,this.fps=1/this.frameTime}},togglePaused:function(){var t=getTimeNow();this.paused=!this.paused,this.paused?this.startedPauseAt=t:this.lastTime=this.lastTime+t-this.startedPauseAt},animate:function(t){var i=this;this.gameOver||(this.paused?setTimeout(function(){i.animate(t)},this.PAUSE_TIMEOUT):(this.tick(t),this.clearScreen(),this.startAnimate(t),this.paintUnderSprites(),this.paintOverSprites(),this.paintShapes(),this.updateSprites(t),this.paintSprites(t),this.endAnimaet(),requestAnimationFrame(function(t){i.animate(t)})))},clearScreen:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},pixelsPerFrame:function(t){return t/this.fps},startAnimate:function(){},paintUnderSprites:function(){},paintOverSprites:function(){},endAnimate:function(){},over:function(){},restart:function(){},pass:function(){},destroy:function(){},imageLoadingProgressCallback:null,images:[],imageUrls:[],imagesLoaded:0,imagesFailedToLoad:0,imagesIndex:0,getImage:function(t){return this.images[t]},imageLoadedCallback:function(){this.imagesLoaded++},imageLoadErrorCallback:function(t){this.imagesFailedToLoad++},loadImage:function(t){var i=new Image,e=this;i.src=t,i.addEventListener("load",function(t){e.imageLoadedCallback(t)}),i.addEventListener("error",function(t){e.imageLoadErrorCallback(t)}),this.images[t]=i},loadImages:function(){return this.imagesIndex<this.imageUrls.length&&(this.loadImage(this.imageUrls[this.imagesIndex]),this.imagesIndex++),(this.imagesLoaded+this.imagesFailedToLoad)/this.imageUrls.length*100},queueImage:function(t){this.imageUrls.push(t)},soundOn:!0,soundChannels:[],audio:null,NUM_SOUND_CHANNELS:10,soundInit:function(){this.audio=new Audio;for(var t=0;t<this.NUM_SOUND_CHANNELS;t++){var i=new Audio;this.soundChannels.push(i)}},canPlayOggVorbis:function(){return""!==this.audio.canPlayType('audio/ogg; codecs="vorbis"')},canPlayMp4:function(){return""!==this.audio.canPlayType("audio/mp4")},getAvailableSoundChannel:function(){for(var t,i=0;i<this.NUM_SOUND_CHANNELS;i++)if(t=this.soundChannels[i],t.played&&t.played.length>0){if(t.ended)return t}else if(!t.ended)return t},playSound:function(t){var i=this.getAvailableSoundChannel(),e=document.getElementById(t);i&&e&&(i.src=e.src,i.load(),i.play())},keysListeners:[],keyEventInit:function(){var t=this;window.addEventListener("keydown",function(i){t.keyPressed(i)})},addKeyListener:function(t){this.keysListeners.push(t)},findKeyListener:function(t){var i;return this.keysListeners.forEach(function(e){var n=e.key;n===t&&(i=e.listener)}),i},keyPressed:function(t){var i,e;switch(t.keyCode){case 32:e="space";break;case 83:e="s";break;case 80:e="p";break;case 82:e="restart";break;case 37:e="left arrow";break;case 39:e="right arrow";break;case 38:e="up arrow";break;case 40:e="down arrow"}i=this.findKeyListener(e),i&&i()},HIGH_SCORES_SUFFIX:"_highscores",score:0,highestScore:0,getHighScores:function(){var t=this.gameName+this.HIGH_SCORES_SUFFIX,i=sessionStorage[t];return void 0===i&&(sessionStorage[t]=0),sessionStorage[t]},setHighScore:function(t){var i=this.gameName+this.HIGH_SCORES_SUFFIX,e=this.getHighScores();t>e&&(sessionStorage[i]=t,this.highestScore=t)},clearHighScores:function(){localStorage[this.gameName+game.HIGH_SCORES_SUFFIX]=JSON.stringify([])},addSprite:function(t){this.sprites.push(t)},getSprite:function(t){for(var i=0,e=this.sprites.length;i<e;i++)if(this.sprites[i].name===t)return this.sprites[i];return null},updateSprites:function(t){for(var i=0,e=this.sprites.length;i<e;i++){var n=this.sprites[i];n.update(this.context,t,this.frameTime)}},paintSprites:function(){for(var t,i,e=1;e<this.sprites.length;e++)i=this.sprites[e],i.left<-100&&(this.sprites.splice(e,1),this.shapes.splice(e,1));for(e=0,t=this.sprites.length;e<t;e++)i=this.sprites[e],i.visible&&i.paint(this.context)},addShape:function(t){this.shapes.push(t)},paintShapes:function(){for(var t=0,i=this.shapes.length;t<i;t++){var e=this.shapes[t];e.visible&&(e.stroke(game.context),e.fill(game.context))}},detectCollisions:function(){}},Game=function(){function t(){l.init(d.canvas,d.images[v]),d.addSprite(l.sprite),d.addShape(l.sprite.shape)}function i(t,i,e){var n={left:1292,top:28,width:383,height:22,drawWidth:383*.8,drawHeight:17.6};i.save(),i.drawImage(e,n.left,n.top,n.width,n.height,(t.width-n.drawWidth)/2,(t.height-n.drawHeight)/2-20,n.drawWidth,n.drawHeight),i.restore()}function e(){if(Math.random()>p){var t=Object.create(Cacti),i=Math.floor(5*Math.random());t.init(d.canvas,d.images[v],i),d.addSprite(t.sprite),d.addShape(t.sprite.shape)}}function n(t){if(Math.random()>p+.1){var i=Object.create(Pterosaur),e=Math.random()>.5?t.height-140:t.height-60;i.init(d.canvas,d.images[v],e),d.addSprite(i.sprite),d.addShape(i.sprite.shape),f++}}function s(t,i){g+=d.frameTime,parseInt(i+1)%300===0&&(m=!0),g>u&&(g=0,2===f&&(m=!1,f=0),m?n(t):e())}function r(t){var i=1+t/1e3;p=.6-t/5e3,u=.7-t/5e3,i=i<=2.5?i:2.5,p=p>.5?p:.5,Pterosaur.setVelocity(i),Cacti.setVelocity(i),Background.setVelocity(i)}function a(t){t>1700&&w===!1&&(w=!0,l.goBallistic(d.canvas))}function o(t){v=t,d.queueImage(v)}function h(t){y=t,d.queueImage(y)}function c(){window.addEventListener("blur",function(){var t=getTimeNow();d.paused=!0,d.startedPauseAt=t})}var d=Object.create(Game);d.init("game","canvas"),d.soundInit(),d.paintUnderSprites=function(){d.loading||(Background.drawBackground(d.context,d.images[v],d.fps),l.updateDinosaur())},d.paintOverSprites=function(){},d.startAnimate=function(){if(d.loading&&100===d.loadImages()&&(d.loading=!1,t(),!d.loading&&!d.paused&&!d.gameOver)){if(l.riseTimer.isRunning()||l.fallTimer.isRunning())return;l.jump.status=!0,l.riseTimer.start(),d.playSound("jump"),c()}d.loading||d.paused||d.gameOver||(d.highestScore>0&&Score.drawHIScore(d.canvas,d.context,d.images[v],d.highestScore),Score.drawCurrentScore(d.canvas,d.context,d.images[v],parseInt(d.score)),d.passGame||(d.detectCollisions(),d.score+=.1,s(d.canvas,d.score),r(d.score),a(d.score)))},d.endAnimaet=function(){d.score>2e3&&(d.passGame=!0,d.pass())},d.detectCollisions=function(){var t,i=l.sprite.shape;i&&d.shapes.forEach(function(e){e!==i&&(t=i.collidesWith(e),void 0===t.axis&&0===t.overlap||d.over())})},d.over=function(){d.playSound("hit"),d.setHighScore(parseInt(d.score)),Score.drawHIScore(d.canvas,d.context,d.images[v],d.getHighScores()),i(d.canvas,d.context,d.images[v]),l.dead();var t=Object.create(Restart);t.init(d.canvas),t.addClickEvent(d,d.canvas),t.drawRestart(d.context,d.images[v]),d.gameOver=!0},d.restart=function(){d.shapes=[],d.sprites=[],d.lastTime=0,d.startTime=0,d.frameTime=0,d.fps=0,d.startedPauseAt=0,d.paused=!1,d.gameOver=!1,d.score=0,d.passGame=!1,d.highestScore=d.getHighScores(),l.height=1,Background.reset(),Cacti.reset(),Pterosaur.reset(),l.reset(d.canvas),p=.6,f=0,m=0,w=!1,t(),d.start()},d.pass=function(){d.playSound("pass"),d.setHighScore(parseInt(d.score)),Score.drawHIScore(d.canvas,d.context,d.images[v],d.getHighScores()),""!==y?(d.context.save(),d.context.font="30px Verdana",d.context.fillStyle="535353",d.context.fillText("YOU     WIN",(d.canvas.width-180)/2,70),d.context.drawImage(d.images[y],(d.canvas.width-461)/2,100,461,67),d.context.restore()):(d.context.save(),d.context.font="30px Verdana",d.context.fillStyle="535353",d.context.fillText("YOU     WIN",(d.canvas.width-180)/2,90),d.context.restore());var t=Object.create(Restart);t.init(d.canvas),t.addClickEvent(d,d.canvas),d.gameOver=!0},d.destroy=function(){d=null},d.addKeyListener({key:"p",listener:function(){d.togglePaused()}}),d.addKeyListener({key:"space",listener:function(){if(!d.loading&&!d.paused&&!d.gameOver){if(l.riseTimer.isRunning()||l.fallTimer.isRunning())return;l.jump.status=!0,l.riseTimer.start(),d.playSound("jump")}}}),d.addKeyListener({key:"restart",listener:function(){d.restart()}});var l=Object.create(Dinosaur),p=.6,u=.75,g=0,f=0,m=!1,w=!1,v="",y="";return window.addEventListener("keydown",function x(t){if(32===t.keyCode){var i=document.getElementsByClassName("dinosaur-img")[0];i.style.display="none",d.start(),window.removeEventListener("keydown",x)}}),{setSpriteURL:o,setLogoURL:h}}(),Pterosaur={sprite:null,spriteSheetPainter:null,coordinate:[{left:264,top:0,width:88,height:80,drawWidth:52.8,drawHeight:24},{left:356,top:0,width:88,height:80,drawWidth:52.8,drawHeight:24}],init:function(t,i,e){this.sprite=Object.create(Sprite),this.spriteSheetPainter=Object.create(SpriteSheetPainter),this.sprite.name="pterosaur",this.sprite.painter=this.spriteSheetPainter,this.spriteSheetPainter.cells=this.coordinate,this.spriteSheetPainter.image=i,this.sprite.behaviors=[this.move,this.flyInplace],this.sprite.top=e,this.sprite.left=t.width,this.move.self=this,this.sprite.initShape(this.sprite.left+6,this.sprite.top+5,this.coordinate[0].drawHeight,this.coordinate[0].drawHeight)},setVelocity:function(t){this.move.velocityX=400*t},reset:function(){this.move.velocityX=400},move:{velocityX:400,execute:function(t,i,e,n){var s=0;s=this.velocityX*n,t.left-=s,t.shape.move(-s,0)}},flyInplace:{lastAdvance:0,PAGE_FLIP_INTERVAL:200,execute:function(t,i,e,n){e-this.lastAdvance>this.PAGE_FLIP_INTERVAL&&(t.painter.advance(),this.lastAdvance=e)}}},Restart={top:0,left:0,coordinate:{left:3,top:3,width:69,height:61,drawWidth:55.2,drawHeight:61*.8},init:function(t){this.left=(t.width-this.coordinate.drawWidth)/2,this.top=(t.height-this.coordinate.drawHeight)/2+30},drawRestart:function(t,i){t.save(),t.drawImage(i,this.coordinate.left,this.coordinate.top,this.coordinate.width,this.coordinate.height,this.left,this.top,this.coordinate.drawWidth,this.coordinate.drawHeight),t.restore()},windowToCanvas:function(t,i){var e=i.x||i.clientX,n=i.y||i.clientY,s=t.getBoundingClientRect();return{x:e-s.left*(t.width/s.width),y:n-s.top*(t.height/s.height)}},addClickEvent:function(t,i){var e=this,n=function s(e){32===e.keyCode&&(t.restart(),i.onclick=null,window.removeEventListener("keydown",s))};i.onclick=function(s){var r=e.windowToCanvas(i,s);e.left<r.x&&r.x<e.left+e.coordinate.drawWidth&&e.top<r.y&&r.y<e.top+e.coordinate.drawHeight&&(t.restart(),window.removeEventListener("keydown",n),i.onclick=null)},window.addEventListener("keydown",n)}},Score={letter:[{x:1293,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1315,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1334,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1354,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1374,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1393,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1415,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1434,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1454,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1474,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1494,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6},{x:1515,y:0,width:18,height:24,drawWidth:18*.6,drawHeight:24*.6}],drawNumber:function(t,i,e,n,s){t.drawImage(i,this.letter[e].x,this.letter[e].y,this.letter[e].width,this.letter[e].height,n,s,this.letter[e].drawWidth,this.letter[e].drawHeight)},drawCurrentScore:function(t,i,e,n){n+="";for(var s=n.length,r=0;r<5-s;r++)n="0"+n;for(i.save(),r=0;r<5;r++)this.drawNumber(i,e,n[r],t.width-120+20*r,10);i.restore()},drawHIScore:function(t,i,e,n){i.save(),this.drawNumber(i,e,10,t.width-300,10),this.drawNumber(i,e,11,t.width-280,10),n+="";for(var s=n.length,r=0;r<5-s;r++)n="0"+n;for(r=0;r<5;r++)this.drawNumber(i,e,n[r],t.width-240+20*r,10);i.restore()}},BIG_NUMBER=1e6,Point=function(t,i){this.x=t,this.y=i};Point.prototype={rotate:function(t,i){var e,n,s,r;return e=this.x-t.x,n=this.y-t.y,s=e*Math.cos(-i)-n*Math.sin(-i),r=e*Math.sin(-i)+n*Math.cos(-i),new Point(s+t.x,r+t.y)}};var Line=function(t,i){this.p1=t,this.p2=i};Line.prototype.intersectionPoint=function(t){var i,e,n,s,r=new Point;return this.p1.x===this.p2.x?(e=(t.p2.y-t.p1.y)/(t.p2.x-t.p1.x),s=t.p1.y-e*t.p1.x,r.x=this.p1.x,r.y=e*r.x+s):t.p1.x===t.p2.x?(i=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),n=this.p1.y-i*this.p1.x,r.x=t.p1.x,r.y=i*r.x+n):(i=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),e=(t.p2.y-t.p1.y)/(t.p2.x-t.p1.x),n=this.p1.y-i*this.p1.x,s=t.p1.y-e*t.p1.x,r.x=(s-n)/(i-e),r.y=i*r.x+n),r};var BoundingBox=function(t,i,e,n){this.left=t,this.top=i,this.width=e,this.height=n},Vector=function(t){void 0===t?(this.x=0,this.y=0):(this.x=t.x,this.y=t.y)};Vector.prototype={getMagnitude:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},setMagnitude:function(t){var i=this.normalize();this.x=i.x*t,this.y=i.y*t},dotProduct:function(t){return this.x*t.x+this.y*t.y},add:function(t){var i=new Vector;return i.x=this.x+t.x,i.y=this.y+t.y,i},subtract:function(t){var i=new Vector;return i.x=this.x-t.x,i.y=this.y-t.y,i},normalize:function(){var t=new Vector,i=this.getMagnitude();return t.x=this.x/i,t.y=this.y/i,t},perpendicular:function(){var t=new Vector;return t.x=this.y,t.y=0-this.x,t},reflect:function(t){var i=new Vector,e=this.dotProduct(t),n=t.dotProduct(t),s=e/n;return i.x=2*s*t.x-this.x,i.y=2*s*t.y-this.y,i}};var Shape=function(){this.fillStyle="rgba(255, 255, 0, 0.8)",this.strokeStyle="white"};Shape.prototype={move:function(t,i){throw"move(dx, dy) not implemented"},createPath:function(t){throw"createPath(context) not implemented"},boundingBox:function(){throw"boundingBox() not implemented"},fill:function(t){t.save(),t.fillStyle=this.fillStyle,this.createPath(t),t.fill(),t.restore()},stroke:function(t){t.save(),t.strokeStyle=this.strokeStyle,this.createPath(t),t.stroke(),t.restore()},collidesWith:function(t,i){throw"collidesWith(shape, displacement) not implemented"},isPointInPath:function(t,i,e){return this.createPath(t),t.isPointInPath(i,e)},project:function(t){throw"project(axis) not implemented"},minimumTranslationVector:function(t,i,e){return getMTV(this,i,e,t)}};var Circle=function(t,i,e){this.x=t,this.y=i,this.radius=e,this.strokeStyle="blue",this.fillStyle="yellow"};Circle.prototype=new Shape,Circle.prototype.centroid=function(){return new Point(this.x,this.y)},Circle.prototype.move=function(t,i){this.x+=t,this.y+=i},Circle.prototype.boundingBox=function(t,i){return new BoundingBox(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},Circle.prototype.createPath=function(t){t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI,!1)},Circle.prototype.project=function(t){var i=[],e=new Point(this.x,this.y);return dotProduct=new Vector(e).dotProduct(t),i.push(dotProduct),i.push(dotProduct+this.radius),i.push(dotProduct-this.radius),new Projection(Math.min.apply(Math,i),Math.max.apply(Math,i))},Circle.prototype.collidesWith=function(t,i){return void 0===t.radius?polygonCollidesWithCircle(t,this,i):circleCollidesWithCircle(this,t,i)};var Polygon=function(t){this.visible=t,this.points=[],this.strokeStyle="blue",this.fillStyle="white"};Polygon.prototype=new Shape,Polygon.prototype.getAxes=function(){for(var t,i,e,n=[],s=0;s<this.points.length-1;s++)t=new Vector(this.points[s]),i=new Vector(this.points[s+1]),e=i.subtract(t),n.push(e.perpendicular().normalize());return n},Polygon.prototype.project=function(t){var i=[];return this.points.forEach(function(e){i.push(new Vector(e).dotProduct(t))}),new Projection(Math.min.apply(Math,i),Math.max.apply(Math,i))},Polygon.prototype.addPoint=function(t,i){this.points.push(new Point(t,i))},Polygon.prototype.createPath=function(t){if(0!==this.points.length){t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=0;i<this.points.length;++i)t.lineTo(this.points[i].x,this.points[i].y)}},Polygon.prototype.move=function(t,i){for(var e,n=0,s=this.points.length;n<s;++n)e=this.points[n],e.x+=t,e.y+=i},Polygon.prototype.collidesWith=function(t,i){return void 0!==t.radius?polygonCollidesWithCircle(this,t,i):polygonCollidesWithPolygon(this,t,i)},Polygon.prototype.move=function(t,i){for(var e,n=0;n<this.points.length;++n)e=this.points[n],e.x+=t,e.y+=i},Polygon.prototype.boundingBox=function(t,i){for(var e,n=BIG_NUMBER,s=BIG_NUMBER,r=-BIG_NUMBER,a=-BIG_NUMBER,o=0;o<this.points.length;++o)e=this.points[o],n=Math.min(n,e.x),s=Math.min(s,e.y),r=Math.max(r,e.x),a=Math.max(a,e.y);return new BoundingBox(n,s,parseFloat(r-n),parseFloat(a-s))},Polygon.prototype.centroid=function(){for(var t,i=new Point(0,0),e=0;e<this.points.length;++e)t=this.points[e],i.x+=t.x,i.y+=t.y;return new Point(i.x/this.points.length,i.y/this.points.length)};var Projection=function(t,i){this.min=t,this.max=i};Projection.prototype={overlaps:function(t){return this.max>t.min&&t.max>this.min},getOverlap:function(t){var i;return this.overlaps(t)?i=this.max>t.max?t.max-this.min:this.max-t.min:0}};var MinimumTranslationVector=function(t,i){this.axis=t,this.overlap=i},SpriteSheetPainter={image:null,cells:[],cellIndex:0,init:function(t,i){this.image=t,this.cells=i},advance:function(){this.cellIndex===this.cells.length-1?this.cellIndex=0:this.cellIndex++},paint:function(t,i){var e=this.cells[this.cellIndex];i.save(),i.drawImage(this.image,e.left,e.top,e.width,e.height,t.left,t.top,e.drawWidth,e.drawHeight),i.restore()}},ImagePainter={cell:null,image:null,init:function(t){this.image=t},paint:function(t,i){i.save(),i.drawImage(this.image,this.cell.left,this.cell.top,this.cell.width,this.cell.height,t.left,t.top,this.cell.drawWidth,this.cell.drawHeight),i.restore()}},Sprite={name:"",painter:void 0,shape:null,top:0,left:0,width:0,height:0,velocityX:0,velocityY:0,visible:!0,shapeVisible:!1,animating:!1,behaviors:[],paint:function(t){void 0!==this.painter&&this.visible&&this.painter.paint(this,t)},update:function(t,i,e){for(var n=0;n<this.behaviors.length;n++)this.behaviors[n].execute(this,t,i,e)},initShape:function(t,i,e,n){for(var s=[new Point(t,i),new Point(t,i+n),new Point(t+e,i+n),new Point(t+e,i),new Point(t,i)],r=new Polygon(this.shapeVisible),a=0,o=s.length;a<o;a++)r.addPoint(s[a].x,s[a].y);this.shape=r,this.shape.fillStyle="orange"},setVisible:function(t){this.shapeVisible=t}},StopWatch={startTime:0,running:!1,elapsedTime:0,start:function(){this.startTime=+new Date,this.elapsedTime=0,this.running=!0},stop:function(){this.running&&(this.elapsedTime=+new Date-this.startTime,this.running=!1)},getElapsedTime:function(){return this.running?+new Date-this.startTime:this.elapsedTime},reset:function(){this.elapsedTime=0,this.startTime=0,this.running=!1}},TimeWarper={timeWarp:void 0,duration:void 0,stopWatch:null,init:function(t,i){this.duration=t,this.timeWarp=i,this.stopWatch=Object.create(StopWatch)},start:function(){this.stopWatch.start()},stop:function(){this.stopWatch.stop()},getElapsedTime:function(){var t=this.stopWatch.getElapsedTime(),i=t/this.duration;if(this.stopWatch.running)return void 0===this.timeWarp?t:t*(this.timeWarp(i)/i)},isRunning:function(){return this.stopWatch.running},isOver:function(){return this.stopWatch.getElapsedTime()>this.duration},makeEaseIn:function(t){return function(i){return Math.pow(i,2*t)}},makeEaseOut:function(t){return function(i){return Math.pow(1-i,2*t)}},makeEaseInOut:function(){return function(t){return t-Math.sin(2*t*Math.PI)/(2*Math.PI)}},makeElastic:function(t){return t=t||3,function(i){return(1-Math.cos(i*Math.PI*t))*(1-i)+i}},makeBounce:function(t){var i=this.makeElastic(t);return function(t){return t=i(t),t<=1?t:2-t}},makeLinear:function(){return function(t){return t}}};